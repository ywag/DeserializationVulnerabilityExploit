package com.example.ywag;

import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.util.Scanner;
import java.util.logging.Level;
import java.util.logging.Logger;

public class Main {

    private static final Logger logger = Logger.getGlobal();
    private static final String FILE = "data.bin"; 
    
    public static void main(String[] args) {
        while(true) {
            System.out.println("送信するオブジェクトを選択してください：");
            System.out.println("1->HashMap,  2->String,  3->LazyMap,  4->AnnotationInvocationHandler,  5->終了");
            Scanner scan = new Scanner(System.in);
            int input = scan.nextInt();
            if(input == 5) {
                break;
            } else {
                new Main().startCUI(input);
            }
        }
    }
    
    public void startCUI(int input) {
        try (FileOutputStream fout = new FileOutputStream(FILE);
                FileInputStream fin = new FileInputStream(FILE)) {
            Client client = new Client(fout);
            Server server = new Server(fin);
            
            switch(input) {
            case 1:
                client.sendHashMap();
                break;
            case 2:
                client.sendLazyMap("calc.exe");
                break;
            case 3:
                client.sendString("hello!");
                break;
            case 4:
                client.sendAnnotationInvocationHandler("calc.exe");
                break;
            default:
                throw new RuntimeException("unexpected input: " + input);
            }
                        
            server.deserialize();
            server.executeBusinessLogic();
            
        } catch (Throwable t) {
            logger.log(Level.SEVERE, t.toString(), t);
        }
    }
}

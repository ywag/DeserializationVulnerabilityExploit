package com.example.ywag;

import java.io.IOException;
import java.io.InputStream;
import java.io.ObjectInputStream;
import java.util.Map;
import java.util.logging.Level;
import java.util.logging.Logger;

public class Server {

    private static Logger logger = Logger.getGlobal();
    
    private ObjectInputStream ois;
    private Map<String, String> receivedObject;
    
    public Server(InputStream in) throws IOException {
        this.ois = new ObjectInputStream(in);
    }

    @SuppressWarnings("unchecked")
    public void deserialize() throws ClassNotFoundException, IOException {
        logger.log(Level.INFO, "start deserialization.");
        Object data = ois.readObject();
        logger.log(Level.INFO, "complete deserialization. (data = " + data.getClass().toGenericString() + ")");
        
        if(data instanceof Map<?,?>) {
            receivedObject = (Map<String, String>)data;
        } else {
            throw new RuntimeException("received unexpected data. (data = " + data.getClass().toGenericString() + ")");
        }
    }
    
    public void executeBusinessLogic() {
        logger.log(Level.INFO, "execute business logic.");
        System.out.println("Received Data: " + receivedObject.get("key"));
    }

}
